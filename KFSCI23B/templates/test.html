<!DOCTYPE html>

<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="/static/styles.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.0/socket.io.js"></script>


    <title>KFSCI23B</title>
</head>
<body style="text-align: center; font-family: Arial, serif; font-size: 14pt">
    <div id="messages" style="margin: 0 auto; width: 60%; text-align: left; min-height: 300px">
        {% for message in messages %}
            <p>{{ message["username"] }}: {{ message["message"] }}</p>
        {% endfor %}
    </div>

    <input type="text" id="message" placeholder="message">
    <button id="sendBtn">Send</button>

    <script type="text/javascript">
        $(document).ready(function() {
            var socket = io.connect("https://laughing-tribble-wr956ggwp75r37qx-5000.app.github.dev");
            var name = "{{ name }}";  // Assuming name is passed into the template

            socket.on('connect', function() {
                socket.send("User connected!");
            });

            socket.on('message', function(data) {
                $('#messages').append($('<p>').text(data));
            });

            $('#sendBtn').on('click', function () {
                var message = $('#message').val();

                // Send the message to the server to store it in the database
                $.ajax({
                    type: "POST",
                    url: "/send_message",
                    contentType: "application/json",
                    data: JSON.stringify({name: name, message: message}),
                    success: function(response) {
                        console.log(response.status);
                        socket.send(name + ': ' + message);
                        $("#message").val('');  // Clear input after sending
                    }
                });
            });
        });
    </script>
</body>

</html>
